<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario con PDF, Excel e Inventario</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Incluir PDFMake desde CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.4/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.4/vfs_fonts.js"></script>
    <!-- Incluir SheetJS desde CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 0;
            background-image: linear-gradient(to right, #4e6643, #797a41);
            background-size: cover;
            background-repeat: no-repeat;
        }
        .form-section {
            border: 1px solid #000;
            padding: 10px;
            margin-bottom: 20px;
        }
        .form-section h3 {
            margin-bottom: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-6xl flex flex-col justify-center items-center">
        <h2 class="text-xl font-semibold text-center mb-4">DIRECCION DE TRANSPORTE UNIVERSITARIO.<br>FORMATO DE INVENTARIO DE VEHICULOS PARA MANTENIMIENTO.</h2>
        
        <!-- Sección de Datos del Usuario y del Vehículo -->
        <div class="form-section w-full">
            <h3>DATOS DEL USUARIO</h3>
            <div class="mb-2">
                <label class="block">ESPAZIO UNIVERSITARIO:</label>
                <input type="text" class="border w-full p-1" placeholder="Espacio Universitario">
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block">NOMBRE DEL RESPONSABLE DEL VEHÍCULO:</label>
                    <input type="text" class="border w-full p-1" placeholder="Nombre del Responsable">
                </div>
                <div>
                    <label class="block">FECHA/HORA:</label>
                    <input type="datetime-local" class="border w-full p-1">
                </div>
                <div>
                    <label class="block">TELEFONO:</label>
                    <input type="tel" class="border w-full p-1" placeholder="Teléfono">
                </div>
            </div>
        </div>

        <div class="form-section w-full">
            <h3>DATOS DEL VEHÍCULO</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block">MARCA:</label>
                    <input type="text" class="border w-full p-1" placeholder="Marca">
                </div>
                <div>
                    <label class="block">TIPO:</label>
                    <input type="text" class="border w-full p-1" placeholder="Tipo">
                </div>
                <div>
                    <label class="block">MODELO:</label>
                    <input type="text" class="border w-full p-1" placeholder="Modelo">
                </div>
                <div>
                    <label class="block">PLACAS:</label>
                    <input type="text" class="border w-full p-1" placeholder="Placas">
                </div>
                <div>
                    <label class="block">KILOMETRAJE:</label>
                    <input type="text" class="border w-full p-1" placeholder="Kilometraje">
                </div>
                <div>
                    <label class="block">No ECO:</label>
                    <input type="text" class="border w-full p-1" placeholder="No ECO">
                </div>
            </div>
        </div>

        <!-- Resto del formulario -->
        <h2 class="text-2xl font-semibold text-gray-700 mb-6 text-center">Formulario de Contacto</h2>
        <form id="contactForm" class="space-y-4 w-full">
            <!-- Datos de Contacto -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-600">Nombre</label>
                    <input type="text" id="name" name="name" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400" required>
                </div>
                <div>
                    <label for="message" class="block text-sm font-medium text-gray-600">Mensaje</label>
                    <textarea id="message" name="message" rows="4" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400" required></textarea>
                </div>
            </div>

            <!-- Inventarios -->
            <h3 class="text-xl font-semibold text-gray-700 mt-6 text-center">Inventario</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Tabla Delantera Frontal -->
                <div class="overflow-x-auto">
                    <table class="inventory-table w-full border-collapse border border-gray-200">
                        <thead>
                            <tr class="bg-green-100">
                                <th colspan="3" class="p-2 text-center">Delantera Frontal</th>
                            </tr>
                            <tr class="bg-gray-100">
                                <th class="p-2 text-center">Elemento</th>
                                <th class="p-2 text-center">Sí</th>
                                <th class="p-2 text-center">No</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Parabrisas</td>
                                <td><input type="radio" name="parabrisas" value="Sí" required></td>
                                <td><input type="radio" name="parabrisas" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Limpiadores</td>
                                <td><input type="radio" name="limpiadores" value="Sí" required></td>
                                <td><input type="radio" name="limpiadores" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Antena</td>
                                <td><input type="radio" name="antena" value="Sí" required></td>
                                <td><input type="radio" name="antena" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Defensa</td>
                                <td><input type="radio" name="defensa" value="Sí" required></td>
                                <td><input type="radio" name="defensa" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Moldura</td>
                                <td><input type="radio" name="moldura" value="Sí" required></td>
                                <td><input type="radio" name="moldura" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Parrilla</td>
                                <td><input type="radio" name="parrilla" value="Sí" required></td>
                                <td><input type="radio" name="parrilla" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Porta Placa</td>
                                <td><input type="radio" name="portaplaca" value="Sí" required></td>
                                <td><input type="radio" name="portaplaca" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Faros</td>
                                <td><input type="radio" name="faros" value="Sí" required></td>
                                <td><input type="radio" name="faros" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Emblema</td>
                                <td><input type="radio" name="emblema" value="Sí" required></td>
                                <td><input type="radio" name="emblema" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Cofre</td>
                                <td><input type="radio" name="cofre" value="Sí" required></td>
                                <td><input type="radio" name="cofre" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Faros de Niebla</td>
                                <td><input type="radio" name="farosniebla" value="Sí" required></td>
                                <td><input type="radio" name="farosniebla" value="No" required></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Tabla Costados -->
                <div class="overflow-x-auto">
                    <table class="inventory-table w-full border-collapse border border-gray-200">
                        <thead>
                            <tr class="bg-green-100">
                                <th colspan="5" class="p-2 text-center">Costados</th>
                            </tr>
                            <tr class="bg-gray-100">
                                <th class="p-2 text-center">Elemento</th>
                                <th class="p-2 text-center">Derecho Sí</th>
                                <th class="p-2 text-center">Derecho No</th>
                                <th class="p-2 text-center">Izquierdo Sí</th>
                                <th class="p-2 text-center">Izquierdo No</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Cristales Puertas</td>
                                <td><input type="radio" name="cristales_derecho" value="Sí" required></td>
                                <td><input type="radio" name="cristales_derecho" value="No" required></td>
                                <td><input type="radio" name="cristales_izquierdo" value="Sí" required></td>
                                <td><input type="radio" name="cristales_izquierdo" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Puertas</td>
                                <td><input type="radio" name="puertas_derecho" value="Sí" required></td>
                                <td><input type="radio" name="puertas_derecho" value="No" required></td>
                                <td><input type="radio" name="puertas_izquierdo" value="Sí" required></td>
                                <td><input type="radio" name="puertas_izquierdo" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Espejo Lateral</td>
                                <td><input type="radio" name="espejo_derecho" value="Sí" required></td>
                                <td><input type="radio" name="espejo_derecho" value="No" required></td>
                                <td><input type="radio" name="espejo_izquierdo" value="Sí" required></td>
                                <td><input type="radio" name="espejo_izquierdo" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Molduras</td>
                                <td><input type="radio" name="molduras_derecho" value="Sí" required></td>
                                <td><input type="radio" name="molduras_derecho" value="No" required></td>
                                <td><input type="radio" name="molduras_izquierdo" value="Sí" required></td>
                                <td><input type="radio" name="molduras_izquierdo" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Llantas</td>
                                <td><input type="radio" name="llantas_derecho" value="Sí" required></td>
                                <td><input type="radio" name="llantas_derecho" value="No" required></td>
                                <td><input type="radio" name="llantas_izquierdo" value="Sí" required></td>
                                <td><input type="radio" name="llantas_izquierdo" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Tapones Llantas</td>
                                <td><input type="radio" name="tapones_derecho" value="Sí" required></td>
                                <td><input type="radio" name="tapones_derecho" value="No" required></td>
                                <td><input type="radio" name="tapones_izquierdo" value="Sí" required></td>
                                <td><input type="radio" name="tapones_izquierdo" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Tapón Gasolina</td>
                                <td><input type="radio" name="tapon_derecho" value="Sí" required></td>
                                <td><input type="radio" name="tapon_derecho" value="No" required></td>
                                <td><input type="radio" name="tapon_izquierdo" value="Sí" required></td>
                                <td><input type="radio" name="tapon_izquierdo" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Loderas</td>
                                <td><input type="radio" name="loderas_derecho" value="Sí" required></td>
                                <td><input type="radio" name="loderas_derecho" value="No" required></td>
                                <td><input type="radio" name="loderas_izquierdo" value="Sí" required></td>
                                <td><input type="radio" name="loderas_izquierdo" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Chapas y Manijas</td>
                                <td><input type="radio" name="chapas_derecho" value="Sí" required></td>
                                <td><input type="radio" name="chapas_derecho" value="No" required></td>
                                <td><input type="radio" name="chapas_izquierdo" value="Sí" required></td>
                                <td><input type="radio" name="chapas_izquierdo" value="No" required></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Nueva Tabla Trasera Debajo -->
            <div class="mt-4">
                <div class="overflow-x-auto">
                    <table class="inventory-table w-full border-collapse border border-gray-200">
                        <thead>
                            <tr class="bg-green-100">
                                <th colspan="3" class="p-2 text-center">Trasera</th>
                            </tr>
                            <tr class="bg-gray-100">
                                <th class="p-2 text-center">Elemento</th>
                                <th class="p-2 text-center">Sí</th>
                                <th class="p-2 text-center">No</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Medallón</td>
                                <td><input type="radio" name="medallon" value="Sí" required></td>
                                <td><input type="radio" name="medallon" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Micas Calaveras</td>
                                <td><input type="radio" name="micas_calaveras" value="Sí" required></td>
                                <td><input type="radio" name="micas_calaveras" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Defensa</td>
                                <td><input type="radio" name="defensa_trasera" value="Sí" required></td>
                                <td><input type="radio" name="defensa_trasera" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Emblemas</td>
                                <td><input type="radio" name="emblemas_traseros" value="Sí" required></td>
                                <td><input type="radio" name="emblemas_traseros" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Chapa Cajuela</td>
                                <td><input type="radio" name="chapa_cajuela" value="Sí" required></td>
                                <td><input type="radio" name="chapa_cajuela" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Molduras</td>
                                <td><input type="radio" name="molduras_traseras" value="Sí" required></td>
                                <td><input type="radio" name="molduras_traseras" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Herramienta</td>
                                <td><input type="radio" name="herramienta" value="Sí" required></td>
                                <td><input type="radio" name="herramienta" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Gato</td>
                                <td><input type="radio" name="gato" value="Sí" required></td>
                                <td><input type="radio" name="gato" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Llanta Refacc.</td>
                                <td><input type="radio" name="llanta_refaccion" value="Sí" required></td>
                                <td><input type="radio" name="llanta_refaccion" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Porta Placa</td>
                                <td><input type="radio" name="portaplaca_trasera" value="Sí" required></td>
                                <td><input type="radio" name="portaplaca_trasera" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Limpiador</td>
                                <td><input type="radio" name="limpiador_trasero" value="Sí" required></td>
                                <td><input type="radio" name="limpiador_trasero" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Extintor</td>
                                <td><input type="radio" name="extintor" value="Sí" required></td>
                                <td><input type="radio" name="extintor" value="No" required></td>
                            </tr>
                            <tr>
                                <td>Alfombra</td>
                                <td><input type="radio" name="alfombra" value="Sí" required></td>
                                <td><input type="radio" name="alfombra" value="No" required></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <button type="button" onclick="submitForm()" class="w-full bg-blue-500 text-white font-medium py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75">Enviar Archivos por Correo</button>
        </form>
    </div>

    <script>
        async function submitForm() {
            // Captura de datos del formulario
            const name = document.getElementById('name').value.trim();
            const message = document.getElementById('message').value.trim();

            // Validar que los campos no estén vacíos
            if (!name || !message) {
                alert('Por favor, complete todos los campos antes de enviar.');
                return;
            }

            // Captura de valores de los radio buttons de inventario
            const inventory = {};
            document.querySelectorAll('.inventory-table tbody tr').forEach(row => {
                const itemName = row.cells[0].innerText;
                const siChecked = row.cells[1].querySelector('input:checked')?.value || 'Sin selección';
                inventory[itemName] = siChecked;
            });

            // Generar PDF con PDFMake
            const docDefinition = {
                content: [
                    { text: 'Formulario de Contacto', style: 'header' },
                    { text: `Nombre: ${name}`, margin: [0, 10, 0, 5] },
                    { text: 'Mensaje:', margin: [0, 5, 0, 5] },
                    { text: message, margin: [0, 5, 0, 10] },
                    { text: 'Inventario:', margin: [0, 10, 0, 5], style: 'header' },
                    { ul: Object.entries(inventory).map(([key, value]) => `${key}: ${value}`) }
                ],
                styles: {
                    header: {
                        fontSize: 18,
                        bold: true
                    }
                },
                defaultStyle: {
                    font: 'Roboto'
                }
            };

            // Generar PDF y convertir a Blob
            const pdfBlob = await new Promise(resolve => {
                pdfMake.createPdf(docDefinition).getBlob(resolve);
            });

            // Generar Excel con SheetJS
            const wsData = [
                ['Nombre', 'Mensaje'],
                [name, message],
                [],
                ['Inventario', 'Estado'],
                ...Object.entries(inventory).map(([key, value]) => [key, value])
            ];
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, 'Datos');
            const excelBlob = await new Promise(resolve => {
                const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
                resolve(new Blob([wbout], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' }));
            });

            // Enviar los archivos al servidor
            const formData = new FormData();
            formData.append('pdf', pdfBlob, 'formulario.pdf');
            formData.append('excel', excelBlob, 'formulario.xlsx');

            fetch('send_mail.php', {
                method: 'POST',
                body: formData,
            })
            .then(response => response.json())
            .then(data => alert(data.message))
            .catch(error => console.error('Error al enviar los archivos:', error));
        }
    </script>
</body>
</html>
